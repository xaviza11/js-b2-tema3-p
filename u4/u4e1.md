# Tema 3. JavaScript profesional en una aplicaci√≥n web

## Unidad 4. Almacenamiento local usando Cookies

## Ejercicio 3.4.1. (Castellano)

En esta ocasi√≥n vamos a realizar un ejercicio para trabajar con `Cookies` en el navegador, con el objetivo de simplificar el trabajo con ellas y adem√°s ver c√≥mo poder almacenar estructuras m√°s complejas que valores b√°sicos.

Para ello vamos a crear una clase denominada `CookieApi` que dispondr√° de las siguientes propiedades y m√©todos (m√°s adelante explicaremos en detalle cada m√©todo):

- `EXPIRING_DAYS`: propiedad **est√°tica** que guardar√° el valor por defecto de d√≠as de expiraci√≥n de las cookies creadas, que ser√° de `365`.

- `document`: propiedad de la clase que almacenar√° referencia al objeto `document` que reciba en el `constructor`.

- `expirationDate`: m√©todo **est√°tico** que permitir√° obtener la fecha en milisegundos correspondiente a la cantidad de d√≠as indicados a partir de la fecha actual.

- `setCookie`: m√©todo que permitir√° guardar una cookie.

- `getCookie`: m√©todo que permitir√° obtener el valor de una cookie guardada previamente a trav√©s de su clave.

- `removeCookie`: m√©todo que permitir√° eliminar una cookie guardada previamente a trav√©s de su clave.


Por lo tanto has de implementar:


### A. Clase `CookieApi`

Crea una clase con nombre `CookieApi` que contenga las propiedades y m√©todos arriba indicados.



### B. M√©todo est√°tico `expirationDate`

Este m√©todo recibe un √∫nico par√°metro `nDays` y devuelve la fecha en formato `UTCString` correspondiente al momento actual + el n√∫mero de d√≠as indicados en el par√°metro.



### C. M√©todo `constructor`

El constructor de esta clase puede recibir un par√°metro `document` (opcional), de manera que:

- Si recibe el par√°metro, se le asigna a la propiedad `document` de la clase.

- Si no recibe el par√°metro, se le asigna a la propiedad `document` de la clase la referencia a `window.document`

> **üî• IMPORTANTE.** Debido a la problem√°tica del *testing* en JEST de algunas funcionalidades del navegador (como pueden ser sus APIS y el uso de cookies), se ha requerido esta caracter√≠stica, de manera que desde los tests se le pueda pasar a la clase la referencia al `mock` para la gesti√≥n de cookies que se ha creado y en caso de ejecutarse en un navegador real, no pasarle nada y que como *fallback* coja el objeto real `window.document`.



### D. M√©todo `setCookie`

Este m√©todo recibe tres par√°metros:

- `key`: ser√° la cadena de texto que haga las veces de clave para almacenar el valor de la cookie que se desea guardar.

- `value`: ser√° el valor a guardar en la cookie para la key indicada.

- `nDays`: este par√°metro es opcional, y ser√≠an los d√≠as durante los que la cookie deber√≠a persistir en el navegador en condiciones normales. Su valor por defecto es el indicado en la propiedad est√°tica `EXPIRING_DAYS`

El m√©todo debe guardar la cookie con el `value` indicado asignado a la `key` que se le pasa, con la duraci√≥n correspondiente al par√°metro `nDays`.

Adem√°s queremos que la cookie pueda guardar estructuras m√°s complejas que tipos b√°sicos como n√∫meros o texto, por lo que el m√©todo debe convertir el valor a una cadena `JSON` mediante el m√©todo `stringify`.

Esto habr√° que tenerlo en cuenta a la hora de obtener el valor de la cookie.



### E. M√©todo `getCookie`

Este m√©todo recibe un √∫nico par√°metro `key` de manera que obtiene el valor almacenado para dicha `key` y lo devuelve como un objeto mediante `JSON.parse`.

En caso de que la `key` no se localice en la cookie, debe devolver el valor `null`.



### F. M√©todo `removeCookie`

Este m√©todo recibe un √∫nico par√°metro `key` de manera que elimina la cookie [1] almacenada para dicha `key` y lo devuelve como un objeto mediante `JSON.parse`.

[1] Para eliminar una cookie vamos a considerar darle un valor vac√≠o y establecer su fecha de expiraci√≥n a cero.



### G. Exportar la clase

Para terminar, vamos a exportar la clase `CookieApi` para que pueda ser empleada en otros m√≥dulos.


-----


# Tema 3. JavaScript professional en una aplicaci√≥ web

## Unitat 4. Emmagatzematge local usant Cookies

## Exercici 3.4.1. (Catal√†)

En aquesta ocasi√≥ farem un exercici per treballar amb `Cookies` al navegador, amb l'objectiu de simplificar el treball amb elles i a m√©s veure com poder emmagatzemar estructures m√©s complexes que valors b√†sics.

Per aix√≤ crearem una classe anomenada `CookieApi` que disposar√† de les seg√ºents propietats i m√®todes (m√©s endavant explicarem detalladament cada m√®tode):

- `EXPIRING_DAYS`: propietat **est√†tica** que guardar√† el valor per defecte de dies d'expiraci√≥ de les cookies creades, que ser√† de `365`.

- `document`: propietat de la classe que emmagatzemar√† refer√®ncia a l'objecte `document` que rebi al `constructor`.

- `expirationDate`: m√®tode **est√†tic** que permetr√† obtenir la data en mil¬∑lisegons corresponent a la quantitat de dies indicats a partir de la data actual.

- `setCookie`: m√®tode que permetr√† desar una galeta.

- `getCookie`: m√®tode que permetr√† obtenir el valor d'una galeta guardada pr√®viament a trav√©s de la vostra clau.

- `removeCookie`: m√®tode que permetr√† eliminar una galeta guardada pr√®viament a trav√©s de la vostra clau.


Per tant, has d'implementar:


### A. Classe `CookieApi`

Crea una classe amb nom `CookieApi` que contingui les propietats i m√®todes indicats m√©s amunt.



### B. M√®tode est√†tic `expirationDate`

Aquest m√®tode rep un √∫nic par√†metre `nDays` i torna la data en format `UTCString` corresponent al moment actual + el nombre de dies indicats al par√†metre.



### C. M√®tode `constructor`

El constructor d'aquesta classe pot rebre un par√†metre `document` (opcional), de manera que:

- Si rebeu el par√†metre, se us assigna a la propietat `document` de la classe.

- Si no rebeu el par√†metre, se us assigna a la propietat `document` de la classe la refer√®ncia a `window.document`

> **üî• IMPORTANT.** A causa de la problem√†tica del *testing* a JEST d'algunes funcionalitats del navegador (com poden ser les seves APIS i l'√∫s de cookies), s'ha requerit aquesta caracter√≠stica, de manera que des dels tests se li pugui passar a la classe la refer√®ncia al `mock` per a la gesti√≥ de cookies que s'ha creat i en cas d'executar-se en un navegador real, no passar-li res i que com a *fallback* agafi l'objecte real `window.document`.



### D. M√®tode `setCookie`

Aquest m√®tode rep tres par√†metres:

- `key`: ser√† la cadena de text que faci les vegades de clau per emmagatzemar el valor de la galeta que es vol desar.

- `value`: ser√† el valor a guardar a la galeta per a la key indicada.

- `nDays`: aquest par√†metre √©s opcional, i serien els dies durant els quals la galeta hauria de persistir al navegador en condicions normals. El seu valor per defecte √©s l'indicat a la propietat est√†tica `EXPIRING_DAYS`

El m√®tode ha de guardar la galeta amb el `value` indicat assignat a la `key` que se li passa, amb la durada corresponent al par√†metre `nDays`.

A m√©s volem que la galeta pugui guardar estructures m√©s complexes que tipus b√†sics com ara n√∫meros o text, per la qual cosa el m√®tode ha de convertir el valor a una cadena `JSON` mitjan√ßant el m√®tode `stringify`.

Aix√≤ caldr√† tenir-ho en compte a l'hora d'obtenir el valor de la galeta.



### E. M√®tode `getCookie`

Aquest m√®tode rep un √∫nic par√†metre `key` de manera que obt√© el valor emmagatzemat per a aquesta `key` i el torna com un objecte mitjan√ßant `JSON.parse`.

En cas que la `key` no es localitzi a la galeta, ha de tornar el valor `null`.



### F. M√®tode `removeCookie`

Aquest m√®tode rep un √∫nic par√†metre `key` de manera que elimina la cookie [1] emmagatzemada per a aquesta `key` i ho torna com un objecte mitjan√ßant `JSON.parse`.

[1] Per eliminar una cookie considerarem donar-li un valor buit i establir la seva data d'expiraci√≥ a zero.



### G. Exportar la classe

Per acabar, exportarem la classe `CookieApi` perqu√® pugui ser emprada en altres m√≤duls.
