# Tema 3. JavaScript profesional en una aplicaci√≥n web

## Unidad 3. Eventos personalizados (Custom Events)

## Ejercicio 3.3.1. (Castellano)

Para practicar con eventos personalizados vamos a implementar un sistema de notificaciones de manera que tendremos un elemento que escuchar√° todos los eventos de 2 emisores, cada uno de los cuales lanzar√° un evento personalizado diferente.

Para ello partimos del fichero `u3/index.html` donde ya se dispone del etiquetado HTML necesario para resolver este ejercicio, y donde destacamos:

- Div con clase `js-logger`: que ser√° el encargado de mostrar en su interior el registro de todos los eventos que se producen por los 2 emisores.

- Enlace con clase `js-notification-A`: que ser√° el elemento que al ser pulsado, emitir√° un evento personalizado de tipo A.

- Enlace con clase `jse-notification-B`: que ser√° el elemento que al ser pulsado, emitir√° un evento personalizado de tipo B.


Por lo tanto deber√°s:


### A. Clase `Sender`

Crear una clase `Sender` con las siguientes propiedades y m√©todos:

- Propiedad est√°tica `TYPE_A` con valor de cadena de texto `EVENT_NOTIFICATION_A`

- Propiedad est√°tica `TYPE_B` con valor de cadena de texto `EVENT_NOTIFICATION_B`

- Propiedad privada `#refDom` que almacenar√° la referencia al nodo recibido en el constructor que representa el elemento del DOM asociado a este emisor.

- Propiedad `type` que guardar√° el tipo asignado a la instancia.

- Propiedad `count` que se inicializar√° a 0, y que cada vez que el emisor asociado sea clicado se incrementar√° en 1.

- Constructor que recibe como par√°metros `ref` y `type`. El primero guardar√° la referencia al nodo del DOM que representa el enlace que se usar√° para emitir las notificaciones en la propiedad privada `#refDom`, y el segundo guardar√° el tipo de notificaciones a emitir (`EVENT_NOTIFICATION_A` o `EVENT_NOTIFICATION_B`) en la propiedad `type`.

- M√©todo `init`: que ser√° el encargado de crear el **listener** para el evento `click` del enlace que producir√° como consecuencia la emisi√≥n del evento personalizado mediante el m√©todo `trigger`. Este evento se vincular√° a la referencia del DOM de la que disponemos para este `Sender`.

- M√©todo `trigger`: ser√° el encargado de lanzar la notificaci√≥n de este emisor, mediante un evento personalizado de tipo `type` y que adjuntar√° como datos adicionales en el campo `detail` el valor del contador actualizado en el momento de emitirse.

- M√©todo `render`: se encargar√° de actualizar el contenido del elemento del DOM que representa este emisor, sustituyendo el contenido actual por la cadena:

```
[tipo_sender]: [valor_contador]
```

Donde:

- [tipo_sender]: ser√≠a la letra final del el tipo de evento recibido.
- [valor_contador]: ser√° el valor del contador en el momento de ser llamado este m√©todo.

Es decir, ejemplos de etiquetas finales para estos enlaces ser√≠an `A: 1` o `B: 3`.


### B. Clase `Logger`

Crear una clase `Logger` con las siguientes propiedades y m√©todos:

- Propiedad privada `#refDom` que almacenar√° la referencia al nodo recibido en el constructor que apunta al elemento del DOM que se asocia a esta instancia.

- Propiedad privada `notificationList`: que contendr√° un array con la lista de todos los objetos de eventos recibidos a trav√©s de las notificaciones. Inicialmente vac√≠a.

- Su constructor recibir√° el par√°metro `ref` con la referencia al nodo del DOM que representa al div que se usar√° para mostrar las notificaciones registradas, e inicializar√° los **listeners** necesarios mediante el m√©todo `init`.

- M√©todo `init`: inicializar√° un **listener** por cada tipo de notificaci√≥n sobre el propio `document`, para recibir todos los eventos personalizados. Esos **listeners** tienen que delegar toda su l√≥gica sobre el m√©todo `onNotificationReceived`.

- M√©todo `onNotificationReceived`: que ser√° el encargado de gestionar los objetos de evento recibidos a trav√©s de los **listeners** declarados en `init`. Esa gesti√≥n consiste en guardar el objeto recibido en el evento original en la `notificationList` y actualizar su vista mediante el m√©todo `render`.

Es importante destacar que debe guardar las notificaciones por orden de antig√ºedad, es decir la primera ser√° la √∫ltima en haber sido recibida y la √∫ltima la primera en haber sido recibida. Ordenadas de m√°s recientes a m√°s antiguas.

- M√©todo `render`: actualizar√° el contenido del nodo del DOM referenciado, de manera que contenga un p√°rrafo (etiqueta <p>) por cada notificaci√≥n registrada, con el mensaje de la misma en su interior con el siguiente formato:

```
[tipo_notificacion]: [mensaje]
```

Donde:

- [tipo_notificacion]: ser√≠a el tipo de evento recibido.
- [mensaje]: ser√≠a el mensaje recibido en dicha notificaci√≥n.


- M√©todo `destroy`: que eliminar√° los **listeners** creados en `init` lo que implica que ya no se escuchar√°n m√°s eventos de los dos tipos aunque sean emitidos.

> üí° NOTA: Ten en cuenta que si usas `bind` o `arrow functions` para la gesti√≥n de `this` en los **listeners**, has de gestionarlo correctamente para poder eliminarlos de forma efectiva m√°s adelante.


### C. Llamadas adicionales

Posteriormente implementa las siguientes llamadas sobre √©l:

```js
const notificationADom = document.querySelector('.js-notification-A');
const notificationBDom = document.querySelector('.js-notification-B');
const loggerDom = document.querySelector('.js-logger');

const nA = new Sender(notificationADom, Sender.TYPE_A);
const nB = new Sender(notificationBDom, Sender.TYPE_B);
const logger = new Logger(loggerDom);

notificationADom.click();
notificationADom.click();
notificationBDom.click();
notificationBDom.click();
notificationBDom.click();
notificationBDom.click();
notificationADom.click();

logger.destroy();

notificationADom.click();
notificationBDom.click();
```


-----


# Tema 3. JavaScript professional en una aplicaci√≥ web

## Unitat 3. Esdeveniments personalitzats (Custom Events)

## Exercici 3.3.1. (Catal√†)

Per practicar amb esdeveniments personalitzats implementarem un sistema de notificacions de manera que tindrem un element que escoltar√† tots els esdeveniments de 2 emissors, cadascun dels quals llan√ßar√† un esdeveniment personalitzat diferent.

Per aix√≤ partim del fitxer `u3/index.html` on ja es disposa de l'etiquetatge HTML necessari per resoldre aquest exercici, i on destaquem:

- Div amb classe `js-logger`: que ser√† l'encarregat de mostrar a l'interior el registre de tots els esdeveniments que es produeixen pels 2 emissors.

- Enlla√ß amb classe `js-notification-A`: que ser√† l'element que en ser polsat, emetr√† un esdeveniment personalitzat de tipus A.

- Enlla√ß amb classe `jse-notification-B`: que ser√† l'element que en ser premut, emetr√† un esdeveniment personalitzat de tipus B.


Per tant haur√†s de:


### A. Classe `Sender`

Crear una classe `Sender` amb les seg√ºents propietats i m√®todes:

- Propietat est√†tica `TYPE_A` amb valor de cadena de text `EVENT_NOTIFICATION_A`

- Propietat est√†tica `TYPE_B` amb valor de cadena de text `EVENT_NOTIFICATION_B`

- Propietat privada `#refDom` que emmagatzemar√† la refer√®ncia al node rebut al constructor que representa l'element del DOM associat a aquest emissor.

- Propietat `type` que guardar√† el tipus assignat a la inst√†ncia.

- Propietat `count` que s'inicialitzar√† a 0, i que cada cop que l'emissor associat sigui clicat s'incrementar√† en 1.

- Constructor que rep com a par√†metres `ref` i `type`. El primer guardar√† la refer√®ncia al node del DOM que representa l'enlla√ß que s'usar√† per emetre les notificacions a la propietat privada `#refDom`, i el segon guardar√† el tipus de notificacions a emetre (`EVENT_NOTIFICATION_A` o `EVENT_NOTIFICATION_B`) a la propietat `type`.

- M√®tode `init`: que ser√† l'encarregat de crear el **listener** per a l'esdeveniment `click` de l'enlla√ß que produir√† com a conseq√º√®ncia l'emissi√≥ de l'esdeveniment personalitzat mitjan√ßant el m√®tode `trigger`. Aquest esdeveniment es vincular√† a la refer√®ncia del DOM de qu√® disposem per a aquest `Sender`.

- M√®tode `trigger`: ser√† l'encarregat de llan√ßar la notificaci√≥ d'aquest emissor, mitjan√ßant un esdeveniment personalitzat de tipus `type` i que adjuntar√† com a dades addicionals al camp `detail` el valor del comptador actualitzat en el moment d'emetre's.

- M√®tode `render`: s'encarregar√† d'actualitzar el contingut de l'element del DOM que representa aquest emissor, substituint el contingut actual per la cadena:

```
[tipus_sender]: [valor_comptador]
```

On:

- [tipus_sender]: seria la lletra final del tipus d'esdeveniment rebut.
- [valor_comptador]: ser√† el valor del comptador en el moment de ser anomenat aquest m√®tode.

√âs a dir, exemples d'etiquetes finals per a aquests enlla√ßos serien `A:1` o `B:3`.


### B. Classe `Logger`

Crear una classe `Logger` amb les seg√ºents propietats i m√®todes:

- Propietat privada `#refDom` que emmagatzemar√† la refer√®ncia al node rebut al constructor que apunta a l'element del DOM que s'associa a aquesta inst√†ncia.

- Propietat privada `notificationList`: que contindr√† un array amb la llista de tots els objectes d'esdeveniments rebuts a trav√©s de les notificacions. Inicialment buida.

- El seu constructor rebr√† el par√†metre `ref` amb la refer√®ncia al node del DOM que representa el div que s'usar√† per mostrar les notificacions registrades, i inicialitzar√† els **listeners** necessaris mitjan√ßant el m√®tode `init`.

- M√®tode `init`: inicialitzar√† un **listener** per cada tipus de notificaci√≥ sobre el propi `document`, per rebre tots els esdeveniments personalitzats. Aquests **listeners** han de delegar tota la seva l√≤gica sobre el m√®tode `onNotificationReceived`.

- M√®tode `onNotificationReceived`: que ser√† l'encarregat de gestionar els objectes d'esdeveniment rebuts a trav√©s dels **listeners** declarats a `init`. Aquesta gesti√≥ consisteix a desar l'objecte rebut a l'esdeveniment original a la `notificationList` i actualitzar la seva vista mitjan√ßant el m√®tode `render`.

√âs important destacar que ha de guardar les notificacions per ordre d'antiguitat, √©s a dir, la primera ser√† l'√∫ltima en haver estat rebuda i l'√∫ltima la primera en haver estat rebuda. Ordenades de m√©s recents a m√©s antigues.

- M√®tode `render`: actualitzar√† el contingut del node del DOM referenciat, de manera que contingui un par√†graf (etiqueta <p>) per cada notificaci√≥ registrada, amb el missatge de la mateixa al seu interior amb el format seg√ºent:

```
[tipus_notificacion]: [missatge]
```

On:

- [tipus_notificacion]: seria el tipus d'esdeveniment rebut.
- [missatge]: seria el missatge rebut en aquesta notificaci√≥.


- M√®tode `destroy`: que eliminar√† els **listeners** creats a `init` el que implica que ja no s'escoltaran m√©s esdeveniments dels dos tipus encara que siguin emesos.

> üí° NOTA: Tingues en compte que si uses `bind` o `arrow functions` per a la gesti√≥ de `this` als **listeners**, has de gestionar-ho correctament per poder eliminar-los de forma efectiva m√©s endavant.


### C. Crides addicionals

Posteriorment implementa les seg√ºents crides sobre ell:

```js
const notificationADom = document.querySelector('.js-notification-A');
const notificationBDom = document.querySelector('.js-notification-B');
const loggerDom = document.querySelector('.js-logger');

const nA = new Sender(notificationADom, Sender.TYPE_A);
const nB = new Sender(notificationBDom, Sender.TYPE_B);
const logger = new Logger(loggerDom);

notificationADom.click();
notificationADom.click();
notificationBDom.click();
notificationBDom.click();
notificationBDom.click();
notificationBDom.click();
notificationADom.click();

logger.destroy();

notificationADom.click();
notificationBDom.click();
```
