# Tema 3. JavaScript profesional en una aplicaci√≥n web

## Unidad 2. Delegaci√≥n de eventos

## Ejercicio 3.2.1. (Castellano)

En esta unidad vamos a trabajar la delegaci√≥n de eventos en JavaScript, para lo que implementaremos una versi√≥n sencilla de una TODO List.

Para ello puedes contar con la lista de tareas inicial en el array `TASK_LIST` que se encuentra en el mismo fichero `u2e1.js`.

Como puedes ver un "todo / tarea" se compone de dos campos:

- `name`: nombre de la tarea a realizar.
- `done`: valor `booleano` verdadero o falso que indica si la tarea est√° hecha o pendiente.

Contamos con un fichero `index.html` que carga el fichero `u2e1.js` y sobre el que se tienen que realizar las siguientes tareas:


### A. Template `tpl-todo`

Crear un template con id `tpl-todo` dentro del fichero html que contenga esta estructura HTML en su interior:

```html
<li class="js-todo" data-todo="[*name*]" data-done="[*done*]">
    <span class="js-todo-name">[*name*]</span>
    <a class="js-todo-done">complete</a>
    <a class="js-todo-delete">delete</a>
</li>
```


### B. Clase `TodoList`

Crea una clase denominada TodoList que permita gestionar la lista de TODOs.
Esta clase constar√° con 3 propiedades **privadas** `appRef`, `listRef` y `todoTpl`.

Para ello su `constructor` recibir√° 3 par√°metros:

- `appRef`: la referencia del nodo del DOM con id `app`, se asignar√° a la propiedad **privada** `appRef`.

- `listRef`: la referencia del nodo del DOM donde se ha de generar la vista HTML de la misma, se asignar√° a la propiedad **privada** `listRef`.

- `todoTpl`: la referencia de la etiqueta `template` con id `todo-tpl` que servir√° para generar el HTML de las tareas de la lista. Se asignar√° a la propiedad **privada** `todoTpl`.


### C. Propiedad `list`

La clase tambi√©n ha de contar con una propiedad `list` de tipo `array` que almacenar√° la lista de objetos de tipo tarea.


### D. M√©todo `init`

Crea un m√©todo `init` que se llamar√° desde el constructor y que inicializar√° el **listener** necesario para que al pulsar el enlace con clase `.js-todo-add` se a√±ada una nueva tarea a la lista con el nombre contenido en `js-todo-new-name` y con un estado pendiente (es decir, su propiedad `done` a `false`)


### E. M√©todo `add`

Implementa un m√©todo `add` que recibe como par√°metros `todo` y `status`, y lo que hace es:

- Si el par√°metro `todo` es una cadena de texto vac√≠a, no hace nada y devuelve `false`.

- Si ya existe un todo con un `name` igual al par√°metro `todo` devuelve `false`.

- Si no existe, a√±ade un nuevo todo al final de la lista asignando el par√°metro `name` al nombre del todo, y el par√°metro `status` al campo `done`, devolviendo true.


### F. M√©todo `remove`

Tambi√©n ha de implementar un m√©todo `remove` que recibe como par√°metro el nombre del todo a eliminar y lo borra de `list` en caso de encontrarlo.


### G. M√©todo `toggle`

Implementa un m√©todo `toggle` que recibe como par√°metro el nombre del todo a dar por completado y cambia su estado del campo `done` por el opuesto.

### H. M√©todo `render`

Finalmente, implementa un m√©todo `render` que a partir de la lista de tareas (`list`) genere la vista HTML dentro del nodo referenciado en el constructor como `listRef`.

Para ello borrar√° el contenido que hubiera en `listRef` y recorrer√° todas las tareas de `list` generando un nodo por cada una de ellas a partir de la plantilla `todo-tpl` con el siguiente criterio:

- `data-todo`: atributo con el nombre de la tarea contenida en el campo `name` de la tarea.
- `data-done`: atributo con el valor `true` o `false` en funci√≥n del estado de la tarea representada en el campo `done`.
- `js-todo-name`: clase para poder manipular el nodo que contendr√° el nombre de la tarea (campo `name`)
- `js-todo-done`: clase para poder manipular el nodo que contendr√° mostrar√° la palabra `done` cuando la tarea est√© realizada (campo `done` a `true`) y mostrar√° la palabra `pending` cuando la tarea est√© pendiente de realizar (campo `done` a `false`). Este enlace permitir√° cambiar el estado de una tarea como veremos m√°s adelante.
- `js-todo-delete`: clase para poder manipular el nodo que contendr√° Este enlace permitir√° eliminar una tarea de la lista como veremos m√°s adelante.

### I. Delegaci√≥n de eventos

Para dotar de interactividad a la aplicaci√≥n web tendremos que delegar algunos eventos, concretamente:

1) Click en `.js-todo-add`: Este elemento de la interfaz lanza un evento cuando es clicado, de manera que inserte una nueva tarea en la lista con el valor que en ese momento se ha introducido en el campo con clase `.js-todo-new-name` y un estado a `false`

2) Click en `.js-todo-done`: Cuando se hace click sobre este elemento de cada tarea de la lista, hace que cambie el estado de dicha tarea y por consiguiente tambi√©n su etiqueta dependiendo de dicho estado.

3) Click en `.js-todo-delete`: Cuando se hace click sobre este elemento de cada tarea de la lista, hace que se elimine dicha tarea de ella y por consiguiente tambi√©n del DOM.

> üí° NOTA: Los **clicks** en `.js-todo-done` y `.js-todo-delete` se pueden gestionar con un √∫nico **listener** por tarea, que dependiendo del `target` clicado sea el que decida si se ha de llamar a un cambio de estado `toggle` o un borrado de tarea `remove`.


### J. Llamada a `render`

Cada operaci√≥n que modifique la propiedad `list` de la clase ha de lanzar al final de la misma una llamada al m√©todo `render` para que la lista se actualice en pantalla.


### K. Instanciaci√≥n

Crea una instancia denominada `todosApp` de la clase TodoList pas√°ndole como par√°metros los nodos que referencia al elemento con id `app`, el elemento con clase `.js-todo-list` y el template con id `todo-tpl`.


### L. Generaci√≥n inicial de tareas

Recorre el array `TASK_LIST` que hemos dejado a tu disposici√≥n de manera que por cada elemento del mismo se a√±ada una tarea a la instancia creada en el punto anterior mediante su m√©todo `add`.


### M. Llamadas adicionales

Posteriormente implementa las siguientes llamadas sobre √©l:

```js
todosApp.add('New one', false);
todosApp.toggle('Shopping');
todosApp.remove('Call mom');
todosApp.add('Another one', true);

document.querySelector('.js-todo-new-name').value = 'Test';
document.querySelector('.js-todo-add').click();

document.querySelector('.js-todo[data-todo="New one"] .js-todo-done').click();
document.querySelector('.js-todo[data-todo="Another one"] .js-todo-delete').click();
```


-----


# Tema 3. JavaScript professional en una aplicaci√≥ web

## Unitat 2. Delegaci√≥ d'esdeveniments

## Exercici 3.2.1. (Catal√†)

En aquesta unitat treballarem la delegaci√≥ d'esdeveniments en JavaScript, per aix√≤ implementarem una versi√≥ senzilla d'una TODO List.

Per aix√≤ pots comptar amb la llista de tasques inicial a l'array `TASK_LIST` que es troba al mateix fitxer `u2e1.js`.

Com pots veure un "todo / tasca" es compon de dos camps:

- `name`: nom de la tasca a fer.
- `done`: valor `boole√†` veritable o fals que indica si la tasca est√† feta o pendent.

Comptem amb un fitxer `index.html` que carrega el fitxer `u2e1.js` i sobre el qual s'han de realitzar les tasques seg√ºents:


### A. Template `tpl-todo`

Crear un template amb id `tpl-todo` dins del fitxer html que contingui aquesta estructura HTML al seu interior:

```html
<li class="js-todo" data-todo="[*name*]" data-done="[*done*]">
     <span class="js-todo-name">[*name*]</span>
     <a class="js-todo-done">complet</a>
     <a class="js-todo-delete">delete</a>
</li>
```


### B. Classe `TodoList`

Crea una classe anomenada TodoList que permeti gestionar la llista de TODO.
Aquesta classe constar√† amb 3 propietats **privades** `appRef`, `listRef` i `totTpl`.

Per aix√≤ el seu `constructor` rebr√† 3 par√†metres:

- `appRef`: la refer√®ncia del node del DOM amb id `app`, s'assignar√† a la propietat **privada** `appRef`.

- `listRef`: la refer√®ncia del node del DOM on s'ha de generar la vista HTML de la mateixa, s'assignar√† a la propietat **privada** `listRef`.

- `totTpl`: la refer√®ncia de l'etiqueta `template` amb id `tot-tpl` que servir√† per generar l'HTML de les tasques de la llista. S'assignar√† a la propietat **privada** `totTpl`.


### C. Propietat `list`

La classe tamb√© ha de tenir una propietat `list` de tipus `array` que emmagatzemar√† la llista d‚Äüobjectes de tipus tasca.


### D. M√®tode `init`

Crea un m√®tode `init` que es trucar√† des del constructor i que inicialitzar√† el **listener** necessari perqu√® en pr√©mer l'enlla√ß amb classe `.js-todo-add` s'afegeixi una nova tasca a la llista amb el nom contingut a `js-todo-new-name` i amb un estat pendent (√©s a dir, la seva propietat `done` a `false`)


### E. M√®tode `add`

Implementa un m√®tode `add` que rep com a par√†metres `todo` i `status`, i el que fa √©s:

- Si el par√†metre `todo` √©s una cadena de text buida, no fa res i torna `false`.

- Si ja existeix un tot amb un `name` igual al par√†metre `todo` retorna `false`.

- Si no existeix, afegeix un nou todo al final de la llista assignant el par√†metre `name` al nom del todo, i el par√†metre `status` al camp `done`, retornant true.


### F. M√®tode `remove`

Tamb√© ha d'implementar un m√®tode `remove` que rep com a par√†metre el nom del todo a eliminar i l'esborra de `list` en cas de trobar-lo.


### G. M√®tode `toggle`

Implementa un m√®tode `toggle` que rep com a par√†metre el nom del todo a donar per completat i canvia el seu estat del camp `done` per l'oposat.

### H. M√®tode `rendre`

Finalment, implementa un m√®tode `render` que a partir de la llista de tasques (`list`) generi la vista HTML dins del node referenciat al constructor com `listRef`.

Per a aix√≤ esborrar√† el contingut que hi hagu√©s a `listRef` i recorrer√† totes les tasques de `list` generant un node per cadascuna d'elles a partir de la plantilla `todo-tpl` amb el seg√ºent criteri:

- `data-todo`: atribut amb el nom de la tasca continguda al camp `name` de la tasca.
- `data-done`: atribut amb el valor `true` o `false` en funci√≥ de l'estat de la tasca representada al camp `done`.
- `js-todo-name`: classe per poder manipular el node que contindr√† el nom de la tasca (camp `name`)
- `js-todo-done`: classe per poder manipular el node que contindr√† mostrar√† la paraula `done` quan la tasca estigui realitzada (camp `done` a `true`) i mostrar√† la paraula `pending` quan la tasca estigui pendent de realitzar (camp `done` a `false`). Aquest enlla√ß us permetr√† canviar l'estat d'una tasca com veurem m√©s endavant.
- `js-todo-delete`: classe per poder manipular el node que contindr√† Aquest enlla√ß permetr√† eliminar una tasca de la llista com veurem m√©s endavant.

### I. Delegaci√≥ d'esdeveniments

Per dotar d'interactivitat l'aplicaci√≥ web haurem de delegar alguns esdeveniments, concretament:

1) Click a `.js-todo-add`: Aquest element de la interf√≠cie llan√ßa un esdeveniment quan √©s clicat, de manera que insereix una nova tasca a la llista amb el valor que en aquest moment s'ha introdu√Øt al camp amb classe `.js-todo-new-name` i un estat a `false`

2) Click a `.js-todo-done`: Quan es fa clic sobre aquest element de cada tasca de la llista, fa que canvi√Ø l'estat d'aquesta tasca i per tant tamb√© la seva etiqueta depenent d'aquest estat.

3) Click a `.js-todo-delete`: Quan es fa clic sobre aquest element de cada tasca de la llista, fa que s'elimini aquesta tasca d'ella i per tant tamb√© del DOM.

> üí° NOTA: Els **clicks** a `.js-todo-done` i `.js-todo-delete` es poden gestionar amb un √∫nic **listener** per tasca, que depenent del `target` clicat sigui el que decideixi si s'ha de cridar a un canvi d'estat `toggle` o un esborrat de tasca `remove`.


### J. Trucada a `rendre`

Cada operaci√≥ que modifiqui la propietat `list` de la classe ha de llan√ßar al final una crida al m√®tode `render` perqu√® la llista s'actualitzi en pantalla.


### K. Instanciaci√≥

Crea una inst√†ncia anomenada `todosApp` de la classe TodoList passant-li com a par√†metres els nodes que refer√®ncia a l'element amb id `app`, l'element amb classe `.js-todo-list` i el template amb id `todo-tpl`.


### L. Generaci√≥ inicial de tasques

Recorre l'array `TASK_LIST` que hem deixat a la vostra disposici√≥ de manera que per cada element del mateix s'afegeixi una tasca a la inst√†ncia creada al punt anterior mitjan√ßant el seu m√®tode `add`.


### M. Crides addicionals

Posteriorment implementa les seg√ºents crides sobre ell:

```js
todosApp.add('New one', false);
todosApp.toggle('Shopping');
todosApp.remove('Call mom');
todosApp.add('Another one', true);

document.querySelector('.js-todo-new-name').value = 'Test';
document.querySelector('.js-todo-add').click();

document.querySelector('.js-todo[data-todo="New one"] .js-todo-done').click();
document.querySelector('.js-todo[data-todo="Another one"] .js-todo-delete').click();
```
